{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Donation | DonateHub</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background:
                linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)),
                url("{% static 'images/bg.png' %}");
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
        }

        .donation-card {
            max-width: 650px;
            margin: 90px auto;
            padding: 35px;
            border-radius: 18px;
            background: rgba(255,255,255,0.95);
            box-shadow: 0 10px 35px rgba(0,0,0,0.3);
        }

        .donation-title {
            font-weight: bold;
            color: #0d6efd;
        }

        .ai-btn {
            font-size: 0.9rem;
        }
    </style>
</head>

<body>

<div class="donation-card">

    <h3 class="text-center donation-title mb-3">
        Add Donation
    </h3>

    <p class="text-center text-muted mb-4">
        Help communities by donating reusable items such as clothes, books, toys, and essentials.
    </p>

    <form method="post">
        {% csrf_token %}

        <!-- CATEGORY -->
        <div class="mb-3">
            <label class="form-label">Donation Category</label>
            <input
                type="text"
                class="form-control"
                name="category"
                id="id_category"
                placeholder="Click AI suggestion or enter manually"
                required
            >
        </div>

        <!-- DESCRIPTION -->
        <div class="mb-3">
            <label class="form-label">Donation Description</label>
            <textarea
                class="form-control"
                name="description"
                id="id_description"
                rows="4"
                placeholder="Example: Old school textbooks and notebooks"
                required
            ></textarea>

            <button
                type="button"
                class="btn btn-info btn-sm mt-2 ai-btn"
                onclick="getCategory()"
            >
                ðŸ¤– Suggest Category (AI)
            </button>
        </div>

        <!-- PICKUP DATE -->
        <div class="mb-3">
            <label class="form-label">Pickup Date</label>
            <input
                type="date"
                class="form-control"
                name="pickup_date"
                required
            >
        </div>

        <!-- SUBMIT -->
        <button type="submit" class="btn btn-success w-100">
            Submit Donation
        </button>

    </form>

</div>

<!-- ================= GEMINI AI SCRIPT (GET BASED) ================= -->
<script>
function getCategory() {
    const description = document.getElementById("id_description").value.trim();

    if (!description) {
        alert("Please enter a description first.");
        return;
    }

    fetch("{% url 'ai_category' %}?description=" + encodeURIComponent(description))
        .then(response => response.json())
        .then(data => {
            document.getElementById("id_category").value = data.category;
        })
        .catch(() => {
            alert("AI service unavailable. Please enter category manually.");
        });
}
</script>

</body>
</html>
